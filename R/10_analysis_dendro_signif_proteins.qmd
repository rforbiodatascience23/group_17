```{r}

```

---
title: "Cluster analysis with all proteomic data"
format: html
editor: visual
---

### Analysis based on significant proteins

We want to see if we get a better clustering when limiting the hierachial analysis to only consider the genes that were significant in our differential expression analysis.

A count matrix with a reduced dataset - with the proteomics data of only the significant proteins - were loaded.

```{r}
#| label: load data
cm_sig <- read.table("../data/count_matrix_significant_proteins.tsv", header = T) |>
  column_to_rownames('id')
```

Next, the hierachial clustering was done exactly as above.

```{r}
#| label: hierachial clustering 2

# create distance matrix (scaled) and perform hierachial clustering
hc <- cm_sig |>
  dist() |> # calculating the distance for each value
  hclust(method = "ward.D2")  # applying the hierachial clustering algorithm to the data 

# save clustering as dendogram
ddg <- as.dendrogram(hc)
  
# extract dendogram order
ddg_order <- order.dendrogram(ddg) # delete if deleting heatmap
  
# extract all dendro information
ddg_data <- dendro_data(ddg)

# add pam50 information to ddg_data
ddg_label <- label(ddg_data) |>
  rename(id = label) |> 
  left_join(clinical_data, by = c("id")) |> 
  select(x,y, id, pam50)

```

And the dendrogram visualised as above.

```{r}

#| label: save results

# create dendogram plot based on hierachial clustering
ddg_plot2 <- ggdendrogram(data = hc, rotate=TRUE) +
  theme(axis.text.y = element_blank(), # removing labels on x axis
        axis.text.x = element_blank(), # removing labels on Y axis
        plot.title = element_text(hjust = 0.5, vjust = 0)) +  
  geom_text(data=ddg_label,
            aes(label=id, x=x, y=-15, colour=pam50), # labels on y axis colored by pam50. 
            size = 1.5) +
  labs(title = "Hierachial clustering based on significant proteins")

ddg_plot2

# save dendrogram plot
ggsave("../results/hc_dendro_sig.png", ddg_plot2, height = 5, width = 6)
```

**Conclusion**: After filtering the dataset on only the significant proteins based on our differential expression analysis, we see a much better agreement between the hierachial clustering of proteomics data and the clinical pam50 assignments.