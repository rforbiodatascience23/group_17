---
title: "05_PCA"
format: html
editor: visual
---

```{r}
#| label: define dataframe

# use this df from the 01_load 
cm <- count_matrix_2

```

```{r}
#| echo: false
#| label: load packages

library(tidyverse)
library(broom)
library(cowplot)

```

```{r}
#| label: augment 

# flip rows and columns
t_count <- t(cm)

# 
clinical_data <- clinical_data |>
  rename(id = "Complete TCGA ID", PAM50 = "PAM50 mRNA")
```

```{r}
#| label: define PCA

#Create a PCA object scaling the data
pca <- t_count |>
        scale() |>
        prcomp()

#Extract variance explained by the PCs
pca_results <- pca |>
  tidy("pcs")

pc1var <- pca_results$percent[1]*100
pc2var <- pca_results$percent[2]*100
```

```{r}
#| label: PCA plot

# Create PCA plot
pca_plot <- pca |> 
  augment(clinical_data) |>
   ggplot(aes(x=.fittedPC1, 
              y=.fittedPC2, 
              color = PAM50,
              fill = PAM50)) +
   geom_point(shape = 21,
             size = 2,
             alpha = 0.5) +
   theme_half_open(12) + 
   theme(plot.title = element_text(hjust = 0.5)) +
   background_grid() +
   xlab(paste('PC1,', pc1var, '% explained variance')) + 
   ylab(paste('PC2,', pc2var, '% explained variance')) +
   labs(
     title = "Initial PCA on entire proteomics dataset",
     color = "PAM50"
        )
  
pca_plot
```

Another attempt but so far not working:

```{r}


# Create PCA plot
pca_aug <- pca |> 
  broom::augment(t_count) |>
  rename(id = ".rownames") |>
  left_join(clinical_data |> select(c(id, PAM50)),
            by = "id")

pca_plot <- pca_aug |>
   ggplot(aes(x=.fittedPC1, 
              y=.fittedPC2, 
              color = `PAM50`)) +
   geom_point(size = 1.5) +
   theme_half_open(12) + 
   
   theme(plot.title = element_text(hjust = 0.5)) +
   background_grid() +
   xlab(paste('PC1,', pc1var, '% explained variance')) + 
   ylab(paste('PC2,', pc2var, '% explained variance')) +
   labs(
     title = "Initial PCA on entire proteomics dataset",
     color = "PAM50"
        )
  
pca_plot
```
